module.exports = function makeGetCompanyEmailByCompanyIdController({
  Joi,
  getCompanyEmailByCompanyId,
  companyExists,
}) {
  return async function createGetCompanyEmailByCompanyIdController(req, res) {
    console.log(
      "Entering get company_email Controller with input as ",
      req.params
    );
    console.log(req.params);
    const database_name = "company";
    console.log(database_name);

    const { company_id } = req.params;
    validInput(company_id);

    const company_id_exists = await companyExists({
      company_id,
      database_name,
    });
    console.log(company_id_exists);

    if (company_id_exists) {
      const company_email = await getCompanyEmailByCompanyId({
        company_id,
        database_name,
      });
      console.info("Exiting get Company_name Controller", company_email);
      
      res.status(200).json({
        status: "Success",
        message: "Company name fetched",
        company_email: company_email,
      });

      return company_email;
    }
     else {
      console.log("Company ID dosen't Exists");
      res.status(201).json({
        status: "Success",
        messege: "Company not exists",
      });
    }
  };

  function validInput(company_id) {
    const schema = Joi.number().integer().required();
    const { error } = schema.validate(company_id);
    if (error) {
      console.error(error);
      throw new Error(`${error.details[0].message}`);
    }
  }
};
